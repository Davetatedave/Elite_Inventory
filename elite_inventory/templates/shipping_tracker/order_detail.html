<div class="d-flex" id="order-details">
    <div class="d-flex flex-column col-4 justify-content-start p-4">
        <div>
            <h3>
                Order <a id="order"
    href="https://www.backmarket.co.uk/bo_merchant/orders/all?see-order-details={{ object.so }}"
    data-so="{{ object.pk }}">{{ object.so }}</a>
            </h3>
            <h4>{{ object.date_created }}</h4>
            <h4>{{ object.customer.channel }}</h4>
            <span class="h5 badge bg-secondary">{{ object.state }}</span>
        </div>
        <div class="infobox d-flex flex-column mt-2">
            <div class="d-flex flex-row flex-nowrap justify-content-between">
                <h5 class="text-decoration-underline">Shipping</h5>
                <a href="#" class="edit-toggle"><i id="editAddress" class="bi bi-pencil text-muted"></i></a>
            </div>
            <div class="address-edit ">
                <form id="addressEditForm" class="noneditable">
                    <input type="text"
                           id="name"
                           value="{{ object.customer.shipping_address.name }}"
                           class="form-control mb-2"
                           data-customer-id="{{ object.customer.pk }}">
                    <input type="text"
                           id="street"
                           value="{{ object.customer.shipping_address.street }}"
                           class="form-control mb-2">
                    <input type="text"
                           id="city"
                           value="{{ object.customer.shipping_address.city }}"
                           class="form-control mb-2">
                    <input type="text"
                           id="state"
                           value="{{ object.customer.shipping_address.state }}"
                           class="form-control mb-2">
                    {% with object.customer.shipping_address.country as country %}
                        {% include "snippets/country_dropdown.html" with country=country %}
                    {% endwith %}
                    <input type="text"
                           id="postalCode"
                           value="{{ object.customer.shipping_address.postalCode }}"
                           class="form-control mb-2">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary cancel-edit">Cancel</button>
                </form>
            </div>
        </div>
    </div>
    <div class="col-4 border-start border-end overflow-auto p-4">
        <h3>Line Items</h3>
        {% for item in object.items.all %}
            <div class="infobox" data-item-id={{ item.item }}>
                <div class="d-flex flex-column justify-content-around">
                    <p>
                        Listing: <strong>{{ item.sku.name }}</strong>
                    </p>
                    <p class="requestedSKU">
                        SKU: <strong>{{ item.sku.sku }}</strong>
                    </p>
                    <p>
                        Price: <strong>{{ object.customer.currency.symbol }}{{ item.unit_cost }}</strong>
                    </p>
                    <p>
                        Quantity: <strong>{{ item.quantity }}</strong>
                    </p>
                    {% with object.devices.all|length  as commited %}
                        <p>Commited {{ commited }} of {{ item.quantity }} :</p>
                        {% for device in object.devices.all %}
                            {% if device.sales_order_item_id == item.item %}
                                <div class="input-group commitedImei">
                                    <p class="form-control m-0">{{ device.imei }}</p>
                                    <i class="bg-warning input-group-text bi bi-x removeIMEI"
                                       data-device="{{ device.pk }}"></i>
                                </div>
                                <br>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% if commited < item.quantity %}
                        <div class="input-group input-group-sm my-2 imeis">
                            <input id="imeiInput{{ forloop.counter }}"
                                   title="Scan IMEI"
                                   placeholder="Scan IMEI"
                                   type="number"
                                   autocomplete="off"
                                   class="form-control imietype"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-sm">
                            <button class="btn btn-sm btn-secondary commitIMEI" disabled>Commit</button>
                            <input title="Force Commit"
                                   type="checkbox"
                                   class="form-check-input h-auto force">
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}
        </div>
    </div>
    <div class="col-4 p-4">
        <h3>Shipping</h3>
        <span class="badge badge-default">Label</span>
        <div class="input-group my-2">
            <button class="input-group-text"
                    id="getShippingPrice"
                    data-customer="{{ object.customer.pk }}">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            <select id="shipperSelect" class="form-control">
                <option value="DHL">DHL</option>
                <option value="UPS">UPS</option>
            </select>
        </div>
        <div class="input-group mb-3" id="shippingPrice">
            <label class="input-group-text" for="serviceSelect">Price</label>
            <select class="form-select" id="serviceSelect">
                <option selected value="">Press Refresh For Prices...</option>
            </select>
        </div>
        {% if total_quantity == object.devices.all|length %}
            <button id="buyShipping"
                    class="mx-auto my-2 btn btn-primary"
                    data-customer="{{ object.customer.pk }}">Buy Shipping</button>
        {% endif %}
        <div id="shipping-info"></div>
    </div>
</div>
